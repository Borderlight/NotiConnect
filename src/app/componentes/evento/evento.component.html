<div class="evento-card{{ mostrarDetalles ? ' mostrar-detalles' : '' }}">
  <div class="evento-botones-topright">
    @if (!editMode) {
      <button class="btn-editar" (click)="editarEvento($event)" [attr.aria-label]="'EVENT_CARD.EDIT_EVENT' | translate">
        <img src="/assets/evento/lapiz.png" alt="Editar" class="icono-lapiz">
      </button>
      <button class="btn-descargar" (click)="descargarEvento($event)" [attr.aria-label]="'EVENT_CARD.DOWNLOAD_EVENT' | translate">
        <img src="/assets/evento/descargar.webp" alt="Descargar" class="icono-descargar">
      </button>
      <button class="btn-eliminar" (click)="eliminarEvento($event)" [attr.aria-label]="'EVENT_CARD.DELETE_EVENT' | translate">
        <img src="/assets/evento/papelera.png" [alt]="'EVENT_CARD.DELETE' | translate" class="icono-papelera">
      </button>
    } @else {
      <button class="btn-guardar" (click)="guardarEdicion($event)" [attr.aria-label]="'EVENT_CARD.SAVE_EVENT' | translate">ðŸ’¾</button>
      <button class="btn-cancelar" (click)="cancelarEdicion($event)" [attr.aria-label]="'EVENT_CARD.CANCEL_EDIT' | translate">âœ–</button>
    }
  </div>
  <div class="evento-imagen-col">
    <img [src]="evento.imagen" [alt]="'EVENT_CARD.EVENT_IMAGE' | translate:{title: evento.titulo}" class="evento-imagen">
    <div *ngIf="evento.imagen" class="caratula-label">
      {{ 'FORM.COVER.LABEL' | translate }}
    </div>
  </div>
  <div class="evento-main-col">
    <div class="evento-header">
      <span class="evento-tipo">{{ 'EVENT_TYPES.' + evento.tipoEvento | translate }}</span>
      <span class="acciones">
        <!-- Los botones aquÃ­ quedan ocultos por CSS -->
      </span>
    </div>
    <div class="evento-titulo-detalles-row-alineado">
      <div class="evento-titulo-col">
        @if (!editMode) {
          <h2 class="evento-titulo">{{ evento.titulo }}</h2>
          <p><strong>Departamento:</strong> {{ evento.departamento || 'No especificado' }}</p>
          <p class="evento-descripcion"><strong>DescripciÃ³n:</strong></p>
          <div class="descripcion-contenido">{{ evento.descripcion || 'Sin descripciÃ³n' }}</div>
          <div class="ubicaciones-section">
            <strong>Ubicaciones:</strong>
            @if (evento.ubicaciones && evento.ubicaciones.length > 0) {
              @for (ubicacion of evento.ubicaciones; track ubicacion.fecha) {
                <div class="ubicacion-item">
                  <div class="ubicacion-fecha">
                    <strong>Fecha:</strong> {{ ubicacion.fecha | date:'EEEE, d MMMM y':'':'es-ES' }}
                  </div>
                  <div class="ubicacion-hora">
                    @if (ubicacion.tipoHorario === 'horario' && ubicacion.horaFin) {
                      <strong>Horario:</strong> {{ ubicacion.horaInicio }} - {{ ubicacion.horaFin }}
                    } @else {
                      <strong>Hora:</strong> {{ ubicacion.horaInicio }}
                    }
                  </div>
                  <div class="ubicacion-lugar">
                    <strong>Lugar:</strong> {{ ubicacion.lugar }}@if (ubicacion.aula) { - {{ ubicacion.aula }} }
                  </div>
                </div>
              }
            } @else {
              <div class="ubicacion-item">
                <div class="ubicacion-fecha"><strong>Fecha:</strong> {{ fechaFormateada }}</div>
                <div class="ubicacion-hora"><strong>Hora:</strong> {{ horaTexto }}</div>
                <div class="ubicacion-lugar"><strong>Lugar:</strong> {{ lugarTexto }}</div>
              </div>
            }
          </div>
          <div class="btn-ver-mas-wrapper">
            <button class="btn-ver-mas" (click)="toggleDetalles($event)">
              {{ mostrarDetalles ? 'Ocultar detalles' : 'Ver mÃ¡s detalles' }}
            </button>
          </div>
        } @else {
          <form [formGroup]="editForm">
            <h2 class="evento-titulo"><input formControlName="titulo" class="input-edit" /></h2>
            <p><strong>Departamento:</strong> <input formControlName="departamento" class="input-edit" /></p>
            <p><strong>DescripciÃ³n:</strong> <textarea formControlName="descripcion" class="input-edit textarea-edit"></textarea></p>
            <p><strong>Ponente:</strong> <input formControlName="ponente" class="input-edit" /></p>
            <p><strong>Fecha:</strong> <input formControlName="fecha" class="input-edit" type="date" /></p>
            <p><strong>Hora:</strong> <input formControlName="horaInicio" class="input-edit" type="time" />
              @if (evento.horaFin) {
                <span> - <input formControlName="horaFin" class="input-edit" type="time" /></span>
              }
            </p>
            <p><strong>Lugar:</strong> <input formControlName="lugar" class="input-edit" />
              @if (evento.aula) {
                <span> - <input formControlName="aula" class="input-edit" /></span>
              }
            </p>
            @if (evento.actividad) {
              <p><strong>Actividad:</strong> <input formControlName="actividad" class="input-edit" /></p>
            }
            <div class="btn-ver-mas-wrapper">
              <button class="btn-ver-mas" (click)="toggleDetalles($event)">
                {{ mostrarDetalles ? 'Ocultar detalles' : 'Ver mÃ¡s detalles' }}
              </button>
            </div>
          </form>
        }
      </div>
      @if (mostrarDetalles) {
        <div class="evento-detalles-col-alineado">
          <div class="detalles-evento">
            @if (!editMode) {
              <!-- Ponentes -->
              <div class="detalle-seccion">
                <strong>Ponente(s):</strong>
                @if (ponentesDetallados.length > 0) {
                  @for (ponente of ponentesDetallados; track ponente.nombre) {
                    <div class="detalle-item">
                      <p class="detalle-principal">{{ ponente.nombre }}</p>
                      @if (ponente.afiliacion) {
                        <p class="detalle-secundario">{{ ponente.afiliacion }}</p>
                      }
                    </div>
                  }
                } @else {
                  <p class="detalle-vacio">No especificado</p>
                }
              </div>

              <!-- Actividad -->
              @if (evento.actividad) {
                <div class="detalle-seccion">
                  <strong>Actividad:</strong>
                  <p class="detalle-simple">{{ evento.actividad }}</p>
                </div>
              }

              <!-- Servicios -->
              <div class="detalle-seccion">
                <strong>Servicios:</strong>
                @if (serviciosDetallados.length > 0) {
                  @for (servicio of serviciosDetallados; track servicio.servicio) {
                    <div class="detalle-item">
                      <p class="detalle-principal">{{ servicio.servicio }}</p>
                      @if (servicio.grado) {
                        <p class="detalle-secundario">{{ servicio.grado }}</p>
                      }
                    </div>
                  }
                } @else {
                  <p class="detalle-vacio">-</p>
                }
              </div>

              <!-- Enlaces -->
              <div class="detalle-seccion">
                <strong>Enlaces:</strong>
                @if (enlacesDetallados.length > 0) {
                  @for (enlace of enlacesDetallados; track enlace.url) {
                    <div class="detalle-item">
                      <p class="detalle-principal">{{ enlace.tipo }}</p>
                      <p class="detalle-secundario">
                        <a [href]="enlace.url" target="_blank" rel="noopener noreferrer" class="enlace-externo">
                          {{ enlace.url }}
                        </a>
                      </p>
                    </div>
                  }
                } @else {
                  <p class="detalle-vacio">-</p>
                }
              </div>

              <!-- Adjuntos -->
              <div class="detalle-seccion">
                <strong>Adjuntos:</strong>
                @if (evento.adjuntos && evento.adjuntos.length > 0) {
                  <div class="adjuntos-grid">
                    @for (adjunto of evento.adjuntos; track $index) {
                      <div class="adjunto-item" (click)="abrirAdjunto(adjunto, $index)">
                        @if (esImagen(adjunto)) {
                          <div class="adjunto-imagen-preview">
                            <img [src]="typeof adjunto === 'string' ? adjunto : adjunto.data" [alt]="'Adjunto ' + ($index + 1)" class="imagen-miniatura">
                            <div class="adjunto-overlay">ðŸ“·</div>
                          </div>
                        } @else {
                          <div class="adjunto-archivo-preview">
                            <div class="icono-archivo">{{ obtenerIconoAdjunto(adjunto) }}</div>
                            <div class="adjunto-info">
                              <span class="adjunto-tipo">{{ obtenerTipoAdjunto(adjunto) }}</span>
                            </div>
                          </div>
                        }
                        <div class="adjunto-nombre">
                          {{ obtenerNombreAdjunto(adjunto, $index) }}
                        </div>
                      </div>
                    }
                  </div>
                } @else {
                  <p class="detalle-vacio">-</p>
                }
              </div>
            } @else {
              <form [formGroup]="editForm">
                <p><strong>Servicios:</strong> <input formControlName="servicios" class="input-edit" /></p>
                <p><strong>Adjuntos:</strong> <input formControlName="adjuntos" class="input-edit" /></p>
                <p><strong>Enlaces:</strong> <input formControlName="enlaces" class="input-edit" /></p>
              </form>
            }
            <div style="height: 1.7em;"></div>
          </div>
        </div>
      }
    </div>
  </div>
</div>