<form [formGroup]="formularioEvento" (ngSubmit)="onSubmit()" role="form" aria-labelledby="form-title" [attr.lang]="currentLang">
    <h1 id="form-title">{{ 'FORM.TITLE' | translate }}</h1>
    
    <div class="evento-info-section" role="region" aria-labelledby="info-basica-titulo">
        <h2 id="info-basica-titulo">{{ 'FORM.BASIC_INFO.TITLE' | translate }}</h2>
        <p class="descripcion-campo" id="info-basica-desc">
            {{ 'FORM.BASIC_INFO.DESCRIPTION' | translate }} <br>
            {{ 'FORM.BASIC_INFO.REQUIRED_FIELDS' | translate }}
        </p>

        <div class="campo-form">
            <label for="titulo" id="titulo-label">{{ 'FORM.EVENT.TITLE.LABEL' | translate }} <span class="campo-requerido">*</span></label>
            <p id="titulo-desc" class="campo-descripcion">
                {{ 'FORM.EVENT.TITLE.DESC' | translate }}
            </p>
            <input type="text" 
                   id="titulo" 
                   name="titulo"
                   formControlName="titulo" 
                   aria-describedby="titulo-desc titulo-error"
                   aria-required="true"
                   [attr.aria-invalid]="formularioEvento.get('titulo')?.invalid && formularioEvento.get('titulo')?.touched"
                   autocomplete="off"
                   spellcheck="true"
                   [attr.aria-label]="'FORM.EVENT.TITLE.LABEL' | translate">
            @if (formularioEvento.get('titulo')?.invalid && formularioEvento.get('titulo')?.touched) {
                <p class="mensaje_error" 
                   id="titulo-error" 
                   role="alert"
                   aria-live="assertive">
                    {{ 'FORM.EVENT.TITLE.ERROR' | translate }}
                </p>
            }
            <span id="titulo-error" class="visually-hidden"></span>
        </div>

        <div class="campo-form">
            <label for="ponente" id="ponente-label">{{ 'FORM.EVENT.SPEAKER.LABEL' | translate }} <span class="campo-requerido">*</span></label>
            <p id="ponente-desc" class="campo-descripcion">
                {{ 'FORM.EVENT.SPEAKER.DESC' | translate }}
            </p>
            <input type="text" 
                   id="ponente" 
                   formControlName="ponente" 
                   aria-describedby="ponente-desc ponente-error"
                   aria-required="true"
                   [attr.aria-invalid]="formularioEvento.get('ponente')?.invalid && formularioEvento.get('ponente')?.touched"
                   [attr.aria-label]="'FORM.EVENT.SPEAKER.LABEL' | translate">
            @if (formularioEvento.get('ponente')?.invalid && formularioEvento.get('ponente')?.touched) {
                <p class="mensaje_error" id="ponente-error" role="alert">{{ 'FORM.EVENT.SPEAKER.ERROR' | translate }}</p>
            }
            <span id="ponente-error" class="visually-hidden"></span>
        </div>

        <div class="campo-form">
            <label for="empresaOrganizadora" id="empresa-label">{{ 'FORM.EVENT.ORGANIZER.LABEL' | translate }} <span class="campo-requerido">*</span></label>
            <p id="empresa-desc" class="campo-descripcion">
                {{ 'FORM.EVENT.ORGANIZER.DESC' | translate }}
            </p>
            <input type="text" 
                   id="empresaOrganizadora" 
                   formControlName="empresaOrganizadora" 
                   aria-describedby="empresa-desc empresa-error"
                   aria-required="true"
                   [attr.aria-invalid]="formularioEvento.get('empresaOrganizadora')?.invalid && formularioEvento.get('empresaOrganizadora')?.touched"
                   [attr.aria-label]="'FORM.EVENT.ORGANIZER.LABEL' | translate">
          

            @if (formularioEvento.get('empresaOrganizadora')?.invalid && formularioEvento.get('empresaOrganizadora')?.touched) {
                <p class="mensaje_error" id="empresa-error" role="alert">{{ 'FORM.EVENT.ORGANIZER.ERROR' | translate }}</p>
            }
            <span id="empresa-error" class="visually-hidden"></span>
        </div>

        <div class="campo-form">
            <label for="tipoEvento" id="tipo-label">{{ 'FORM.EVENT.TYPE.LABEL' | translate }} <span class="campo-requerido">*</span></label>
            <p id="tipo-desc" class="campo-descripcion">
                {{ 'FORM.EVENT.TYPE.DESC' | translate }}
            </p>
            <select id="tipoEvento" 
                    formControlName="tipoEvento" 
                    aria-describedby="tipo-desc tipo-error"
                    aria-required="true"
                    [attr.aria-invalid]="formularioEvento.get('tipoEvento')?.invalid && formularioEvento.get('tipoEvento')?.touched"
                    [attr.aria-label]="'FORM.EVENT.TYPE.LABEL' | translate">
                <option value="">{{ 'FORM.SELECT_OPTION' | translate }}</option>
                @for (tipo of tiposEvento; track tipo) {
                    <option [value]="tipo">{{ 'EVENT_TYPES.' + tipo | translate }}</option>
                }
            </select>
            @if (formularioEvento.get('tipoEvento')?.invalid && formularioEvento.get('tipoEvento')?.touched) {
                <p class="mensaje_error" id="tipo-error" role="alert">{{ 'FORM.EVENT.TYPE.ERROR' | translate }}</p>
            }
            <span id="tipo-error" class="visually-hidden"></span>
        </div>

        <div class="campo-form">
            <label for="descripcion" id="descripcion-label">{{ 'FORM.EVENT.DESCRIPTION.LABEL' | translate }} <span class="campo-requerido">*</span></label>
            <p id="descripcion-desc" class="campo-descripcion">
                {{ 'FORM.EVENT.DESCRIPTION.DESC' | translate }}
            </p>
            <textarea id="descripcion" 
                     formControlName="descripcion" 
                     rows="4" 
                     aria-describedby="descripcion-desc descripcion-error"
                     aria-required="true"
                     [attr.aria-invalid]="formularioEvento.get('descripcion')?.invalid && formularioEvento.get('descripcion')?.touched"
                     [attr.aria-label]="'FORM.EVENT.DESCRIPTION.LABEL' | translate"></textarea>
            @if (formularioEvento.get('descripcion')?.invalid && formularioEvento.get('descripcion')?.touched) {
                <p class="mensaje_error" 
                   id="descripcion-error" 
                   role="alert"
                   aria-live="assertive">
                    {{ 'FORM.EVENT.DESCRIPTION.ERROR' | translate }}
                </p>
            }
            <span id="descripcion-error" class="visually-hidden"></span>
        </div>
    </div>

    <div class="evento-info-section" role="region" aria-labelledby="actividad-servicios-titulo">
        <h2 id="actividad-servicios-titulo">{{ 'FORM.ACTIVITY_SERVICES.TITLE' | translate }}</h2>
        <p class="descripcion-campo" id="actividad-servicios-desc">
            {{ 'FORM.ACTIVITY_SERVICES.DESCRIPTION' | translate }} <br> {{ 'FORM.BASIC_INFO.REQUIRED_FIELDS' | translate }}


        </p>

        <div class="campo-form">
            <label for="actividad_relacionada" id="actividad-label">{{ 'FORM.ACTIVITY_SERVICES.RELATED_ACTIVITY.LABEL' | translate }} <span class="campo-requerido">*</span></label>
            <p id="actividad-desc" class="campo-descripcion">
                {{ 'FORM.ACTIVITY_SERVICES.RELATED_ACTIVITY.DESC' | translate }}
            </p>
            <div class="actividad-container">
                <div class="select-container">
                    <select id="actividad_relacionada" 
                            formControlName="actividad_relacionada" 
                            aria-describedby="actividad-desc actividad-error"
                            aria-required="true"
                            [attr.aria-invalid]="formularioEvento.get('actividad_relacionada')?.invalid && formularioEvento.get('actividad_relacionada')?.touched"
                            [attr.aria-label]="'FORM.ACTIVITY_SERVICES.RELATED_ACTIVITY.LABEL' | translate">
                        <option value="">{{ 'FORM.SELECT_OPTION' | translate }}</option>
                        @for (actividad of actividadesRelacionadasTraducidas; track actividad) {
                            <option [value]="actividad">{{ actividad }}</option>
                        }
                    </select>
                    @if (formularioEvento.get('actividad_relacionada')?.invalid && formularioEvento.get('actividad_relacionada')?.touched) {
                        <p class="mensaje_error" 
                           id="actividad-error" 
                           role="alert"
                           aria-live="assertive">
                            {{ 'FORM.ACTIVITY_SERVICES.RELATED_ACTIVITY.ERROR' | translate }}
                        </p>
                    }
                    <span id="actividad-error" class="visually-hidden"></span>
                </div>
                <button type="button" 
                        class="btn-agregar-actividad"
                        [class.cancelar]="mostrarInputActividad"
                        (click)="toggleInputActividad()"
                        [attr.aria-expanded]="mostrarInputActividad"
                        aria-controls="nueva-actividad-form"
                        [attr.aria-label]="mostrarInputActividad ? ('FORM.ACTIVITY_CANCEL' | translate) : ('FORM.ACTIVITY_ADD' | translate)">
                    <span class="button-text">{{ mostrarInputActividad ? ('FORM.ACTIVITY_CANCEL' | translate) : ('FORM.ACTIVITY_ADD' | translate) }}</span>
                </button>
            </div>

            @if (mostrarInputActividad) {
                <div id="nueva-actividad-form" 
                     class="nueva-actividad-container" 
                     role="form" 
                     aria-label="Formulario para aÃ±adir nueva actividad">
                    <p class="campo-descripcion" style="margin-bottom: 0.5rem;">{{ 'FORM.ACTIVITY_HELP' | translate }}</p>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <input type="text" 
                               [(ngModel)]="nuevaActividad" 
                               [ngModelOptions]="{standalone: true}"
                               aria-label="Campo para escribir el nombre de la nueva actividad"
                               style="flex: 1;">
                        <button type="button" 
                                (click)="agregarNuevaActividad()"
                                [disabled]="!nuevaActividad.trim()"
                                class="btn-confirmar"
                                [attr.aria-label]="'FORM.ACTIVITY_CONFIRM' | translate">
                            {{ 'FORM.ACTIVITY_CONFIRM' | translate }}
                        </button>
                    </div>
                </div>
                @if (mostrarErrorActividad) {
                    <p class="mensaje_error" role="alert" aria-live="assertive">{{ mensajeErrorActividad }}</p>
                }
            }

        </div>

        <div class="campo-form" formArrayName="servicios">
            <label for="servicios-titulo" id="servicio-titulo">{{ 'FORM.ACTIVITY_SERVICES.RELATED_SERVICES.LABEL' | translate }} <span class="campo-requerido">*</span></label>
            <p class="descripcion-campo" id="servicios-desc">
                {{ 'FORM.ACTIVITY_SERVICES.RELATED_SERVICES.DESC' | translate }}
            </p>
        @for (campo of listadoServicios.controls; track campo; let i = $index) {
                <div [formGroupName]="i" class="campo-form servicio-section" role="group" [attr.aria-labelledby]="'servicio-' + i + '-label'">
                    <div class="servicio-header">
                        <label [id]="'servicio-' + i + '-label'">
                            Servicio nÃºmero {{i + 1}}
                            <span class="campo-requerido">*</span>
                        </label>
                        <button type="button" 
                            (click)="eliminarServicio(i)"
                            class="btn-eliminar"
                            [attr.aria-label]="'Eliminar servicio ' + (i + 1)">
                            <span class="icono-eliminar" aria-hidden="true">Ã</span>
                            <span class="texto-eliminar">{{ 'FORM.DELETE_BUTTON' | translate }}</span>
                        </button>
                    </div>

                    <div class="select-container">
                        <select [id]="'servicio-' + i" 
                                formControlName="servicios"
                                [attr.aria-describedby]="'servicio-' + i + '-desc servicio-' + i + '-hint servicio-' + i + '-error'"
                                aria-required="true"
                                [attr.aria-invalid]="campo.get('servicios')?.invalid && campo.get('servicios')?.touched"
                                [attr.aria-label]="'Servicio o facultad nÃºmero ' + (i + 1)"
                                [attr.aria-labelledby]="'servicio-' + i + '-label'">
                            <option value="">{{ 'FORM.SELECT_OPTION' | translate }}</option>
                            <optgroup label="{{ 'FORM.FACULTIES_LABEL' | translate }}">
                                @for (facultadObj of facultadesGrados; track facultadObj) {
                                    <option [value]="facultadObj.facultad">{{ 'FACULTADES.' + facultadObj.facultad | translate }}</option>
                                }
                            </optgroup>
                            <optgroup label="{{ 'FORM.SERVICES_LABEL' | translate }}">
                                @for (servicio of serviciosFijos; track servicio) {
                                    <option [value]="servicio">{{ servicio | translate }}</option>
                                }
                            </optgroup>
                            <optgroup label="{{ 'FORM.VICERRECTORADOS_LABEL' | translate }}">
                                @for (vic of vicerrectorados; track vic) {
                                    <option [value]="vic">{{ 'VICERRECTORADOS.' + vic | translate }}</option>
                                }
                            </optgroup>
                        </select>
                    </div>

                    <p [id]="'servicio-' + i + '-desc'" class="visually-hidden"></p>
                    <p [id]="'servicio-' + i + '-hint'" class="visually-hidden"></p>
                    @if (campo.get('servicios')?.invalid && campo.get('servicios')?.touched) {
                        <p class="mensaje_error" 
                           [id]="'servicio-' + i + '-error'"
                           role="alert"
                           aria-live="assertive">
                            {{ 'FORM.ACTIVITY_SERVICES.RELATED_SERVICES.ERROR' | translate }}
                        </p>
                    }
                    @if (!(campo.get('servicios')?.invalid && campo.get('servicios')?.touched)) {
                        <span [id]="'servicio-' + i + '-error'" class="visually-hidden"></span>
                    }
                
                    @if (esFacultadSeleccionada(campo.get('servicios')?.value)) {
                        <div class="campo-grado">
                            <label [for]="'grado-' + i" [id]="'grado-' + i + '-label'">
                                Grado de la {{ campo.get('servicios')?.value }}
                                <span class="campo-requerido">*</span>
                            </label>
                            <p [id]="'grado-' + i + '-desc'" class="campo-descripcion">
                                Seleccione el grado especÃ­fico de la facultad seleccionada
                            </p>
                            <div class="select-container">
                                <select [id]="'grado-' + i" 
                                        formControlName="grado"
                                        [attr.aria-describedby]="'grado-' + i + '-desc grado-' + i + '-error'"
                                        aria-required="true"
                                        [attr.aria-invalid]="campo.get('grado')?.invalid && campo.get('grado')?.touched">
                                    <option value="">{{ 'FORM.SELECT_OPTION' | translate }}</option>
                                @for (grado of obtenerGrados(campo.get('servicios')?.value); track grado) {
                                    <option [value]="grado">{{ grado }}</option>
                                }
                            </select>
                            </div>
                            @if (mostrarErrorGrado && !campo.get('grado')?.value) {
                                <p class="mensaje_error" 
                                   [id]="'grado-' + i + '-error'"
                                   role="alert"
                                   aria-live="assertive">
                                    {{ 'FORM.ACTIVITY_SERVICES.RELATED_SERVICES.GRADE.ERROR' | translate }}
                                </p>
                            }
                        <span [id]="'grado-' + i + '-error'" class="visually-hidden"></span>
                        </div>
                    }
                    
                </div>
            }
            <div class="boton-agregar-container">
                <button type="button" 
                        (click)="anadirCampoServicio()"
                        class="btn-agregar-inline"
                        aria-label="AÃ±adir nuevo servicio">
                    <span class="icono-agregar" aria-hidden="true">+</span>
                    {{ 'FORM.ACTIVITY_SERVICES.RELATED_SERVICES.ADD_BUTTON' | translate }}
                </button>
            </div>
        </div>
    </div>

    <div class="evento-info-section" role="region" aria-labelledby="recursos-digitales-titulo">
        <h2 id="recursos-digitales-titulo">{{ 'FORM.DIGITAL_RESOURCES.TITLE' | translate }}</h2>
        <p class="descripcion-campo" id="recursos-digitales-desc">
            {{ 'FORM.DIGITAL_RESOURCES.DESCRIPTION' | translate }} <br> {{ 'FORM.BASIC_INFO.REQUIRED_FIELDS' | translate }}
        </p>

        <div class="campo-form adjuntos-section" role="group" aria-labelledby="adjuntos-label">
            <label for="adjuntos" id="adjuntos-label" class="form-label">
                {{ 'FORM.DIGITAL_RESOURCES.ATTACHED_FILES.LABEL' | translate }} <span class="campo-requerido">*</span>
            </label>
            
            <div class="campo-descripcion-container">
                <p id="adjuntos-desc" class="campo-descripcion">
                    {{ 'FORM.DIGITAL_RESOURCES.ATTACHED_FILES.DESCRIPTION' | translate }}
                    <span class="campo-requerido">Campo obligatorio</span>
                </p>
                <p id="adjuntos-formato" class="campo-formato">
                    {{ 'FORM.DIGITAL_RESOURCES.ATTACHED_FILES.ACCEPTED_FORMATS' | translate }}
                </p>
            </div>

            <div class="file-input-container">
                <input type="file" 
                       id="adjuntos" 
                       name="adjuntos"
                       multiple 
                       accept=".jpg,.jpeg,.png,.pdf,.mp4"
                       aria-required="true"
                       aria-describedby="adjuntos-desc adjuntos-formato adjuntos-help"
                       [attr.aria-invalid]="formularioEvento.get('adjuntos')?.invalid && formularioEvento.get('adjuntos')?.touched"
                       formControlName="adjuntos">
                
                <p id="adjuntos-help" class="campo-ayuda">
                    {{ 'FORM.DIGITAL_RESOURCES.ATTACHED_FILES.FILE_SELECTOR_HELP' | translate }}
                </p>
            </div>

            @if (formularioEvento.get('adjuntos')?.invalid && formularioEvento.get('adjuntos')?.touched) {
                <div class="mensaje_error" role="alert" aria-live="polite">
                    {{ 'FORM.DIGITAL_RESOURCES.ATTACHED_FILES.ERROR' | translate }}
                </div>
        }
        </div>

        <div class="campo-form" formArrayName="enlaces">
            <label for="enlaces" id="enlaces-label" class="form-label">
                {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.LABEL' | translate }} <span class="campo-requerido">*</span>
            </label>
            
            <div class="campo-descripcion-container">
                <p id="enlaces-desc" class="campo-descripcion">
                    {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.DESCRIPTION' | translate }}
                    <span class="campo-requerido">Campo obligatorio</span>
                </p>
            </div>

        @for (enlace of listadoEnlaces.controls; track enlace; let index2 = $index) {
                <div [formGroupName]="index2" class="agrupacion_enlaces" role="group" [attr.aria-labelledby]="'enlace-' + index2 + '-label'">
                    <div class="enlace-header">
                        <label [id]="'enlace-' + index2 + '-label'" class="enlace-label">
                            Enlace nÃºmero {{index2 + 1}}
                        </label>
                    </div>
            
            <div class="enlace-inputs-reorganizado">
              <div class="selector-icono-row">
                <div class="tipo-enlace-container">
                  <select [id]="'tipo-' + index2"
                          formControlName="tipo"
                          class="tipo-enlace"
                          [attr.aria-invalid]="tieneError(index2, 'tipo')"
                          [attr.aria-describedby]="'tipo-' + index2 + '-error'"
                          [attr.aria-label]="'Tipo de enlace nÃºmero ' + (index2 + 1)"
                          [attr.aria-labelledby]="'tipo-label-' + index2" >
                    <option value="">{{ 'FORM.SELECT_OPTION' | translate }}</option>
                    @for (tipo of tiposEnlace; track tipo) {
                        <option [value]="tipo.nombre">{{ 'LINK_TYPES.' + tipo.nombre | translate }}</option>
                    }
                  </select>
                  <label [id]="'tipo-label-' + index2" class="sr-only">Tipo de enlace</label>
                </div>
                <div class="icono-enlace-container">
                  @if (listadoEnlaces.at(index2).get('tipo')?.value) {
                    <img [src]="obtenerIcono(listadoEnlaces.at(index2).get('tipo')?.value)" 
                         [alt]="'Icono de ' + listadoEnlaces.at(index2).get('tipo')?.value"
                         aria-hidden="true"
                         class="icono-enlace-mini" />
                  }
                </div>
              </div>
              <div class="url-input-container">
                <p class="campo-formato">
                  {{ 'FORM.URL_HELP' | translate }}
                  <span class="campo-formato">({{ 'FORM.URL_EXAMPLE' | translate }})</span>
                </p>
                <input type="url" 
                       [id]="'url-' + index2"
                       formControlName="url" 
                       class="input-enlace"
                       [attr.aria-invalid]="tieneError(index2, 'url')"
                       [attr.aria-describedby]="'url-' + index2 + '-error'"
                       aria-label="Introduce la URL del enlace relacionado">
              </div>
              <div class="eliminar-enlace-row">
                <button type="button"
                        (click)="eliminarEnlace(index2)"
                        class="btn-eliminar btn-eliminar-enlace"
                        [attr.aria-label]="'Eliminar enlace ' + (index2 + 1)">
                  <span class="icono-eliminar" aria-hidden="true">Ã</span>
                  <span class="texto-eliminar">{{ 'FORM.DELETE_BUTTON' | translate }}</span>
                </button>
              </div>
            </div>

            @if (formularioEvento.get('enlaces')?.hasError('requiereEnlaces') && formularioEvento.get('enlaces')?.touched && index2 === 0) {
                <div class="mensaje_error" role="alert" aria-live="polite">
                    {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.ERROR.REQUIRE_LINK' | translate }}
                </div>
            }

            @if (tieneError(index2, 'tipo')) {
                <div class="mensaje_error" role="alert" aria-live="polite">
                    {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.ERROR.SELECT_TYPE' | translate }}
                </div>
            } @else {
                <span [id]="'tipo-' + index2 + '-error'" class="visually-hidden"></span>
            }
            @if (tieneError(index2, 'url')) {
                <div class="mensaje_error" role="alert" aria-live="polite">
                    @if (listadoEnlaces.at(index2).get('tipo')?.value === 'Instagram') {
                            {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.ERROR.INVALID_URL_INSTAGRAM' | translate }}
                        } @else if (listadoEnlaces.at(index2).get('tipo')?.value === 'X') {
                            {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.ERROR.INVALID_URL_X' | translate }}
                        } @else if (listadoEnlaces.at(index2).get('tipo')?.value === 'TikTok') {
                            {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.ERROR.INVALID_URL_TIKTOK' | translate }}
                        } @else if (listadoEnlaces.at(index2).get('tipo')?.value === 'YouTube') {
                            {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.ERROR.INVALID_URL_YOUTUBE' | translate }}
                        } @else if (listadoEnlaces.at(index2).get('tipo')?.value === 'LinkedIn') {
                            {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.ERROR.INVALID_URL_LINKEDIN' | translate }}
                        } @else {
                            {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.ERROR.COMPLETE_LINK' | translate }}
                        }
                </div>
            } @else {
                <span [id]="'url-' + index2 + '-error'" class="visually-hidden"></span>
            }
        </div>
    }

    <div class="boton-agregar-container">
        <button type="button" 
                (click)="anadirEnlace()"
                class="btn-agregar-inline"
                aria-label="AÃ±adir nuevo enlace">
            <span class="icono-agregar" aria-hidden="true">+</span>
            {{ 'FORM.DIGITAL_RESOURCES.RELATED_LINKS.ADD_BUTTON' | translate }}
        </button>
    </div>
</div>
    </div>
        
    <div class="evento-info-section" role="region" aria-labelledby="ubicacion-horario-titulo">
        <h2 id="ubicacion-horario-titulo">{{ 'FORM.LOCATION_TIME.TITLE' | translate }}</h2>
        <p class="descripcion-campo" id="ubicacion-horario-desc">
            {{ 'FORM.LOCATION_TIME.DESCRIPTION' | translate }} <br> {{ 'FORM.BASIC_INFO.REQUIRED_FIELDS' | translate }}
        </p>

        <div class="campo-form" formArrayName="ubicaciones">
            @for (ubicacion of listadoUbicaciones.controls; track ubicacion; let i = $index) {
                <div [formGroupName]="i" class="ubicacion-section" role="group" [attr.aria-labelledby]="'ubicacion-' + i + '-label'">
                    <div class="ubicacion-header">
                        <h3 [id]="'ubicacion-' + i + '-label'" class="align-left">
                            {{ 'FORM.LOCATION_TIME.DATE_PLACE' | translate }} {{i + 1}}
                            <span class="campo-requerido">*</span>
                        </h3>
                        @if (i > 0) {
                            <button type="button" 
                                    (click)="eliminarUbicacion(i)"
                                    class="btn-eliminar"
                                    [attr.aria-label]="'Eliminar fecha y lugar ' + (i + 1)">
                                <span class="icono-eliminar" aria-hidden="true">Ã</span>
                                <span class="texto-eliminar">Eliminar</span>
                            </button>
                        }
                    </div>

                    <div class="campo-form fecha-lugar">
                        <label [for]="'fecha-' + i" [id]="'fecha-' + i + '-label'" class="align-left">{{ 'FORM.LOCATION_TIME.EVENT_DATE.LABEL' | translate }} <span class="campo-requerido">*</span></label>
                        <p [id]="'fecha-' + i + '-desc'" class="campo-descripcion align-left">
                            {{ 'FORM.LOCATION_TIME.EVENT_DATE.DESCRIPTION' | translate }}
                        </p>
                        <input type="date" 
                               [id]="'fecha-' + i" 
                               formControlName="fecha"
                               [attr.aria-describedby]="'fecha-' + i + '-desc fecha-' + i + '-error'"
                               aria-required="true"
                               [attr.aria-invalid]="ubicacion.get('fecha')?.invalid && ubicacion.get('fecha')?.touched">
                        @if (ubicacion.get('fecha')?.invalid && ubicacion.get('fecha')?.touched) {
                            <p class="mensaje_error align-left" 
                               [id]="'fecha-' + i + '-error'" 
                               role="alert"
                               aria-live="assertive">
                                {{ 'FORM.LOCATION_TIME.EVENT_DATE.ERROR' | translate }}
                            </p>
                        }
                        @if (!(ubicacion.get('fecha')?.invalid && ubicacion.get('fecha')?.touched)) {
                            <span [id]="'fecha-' + i + '-error'" class="visually-hidden"></span>
                        }
                    </div>

                    <div class="campo-form">
                        <label [id]="'tipo-horario-' + i + '-label'">{{ 'FORM.LOCATION_TIME.TIME_TYPE.LABEL' | translate }} <span class="campo-requerido">*</span></label>
                        <p [id]="'tipo-horario-' + i + '-desc'" class="campo-descripcion visually-hidden" aria-hidden="true" tabindex="-1">
                            {{ 'FORM.LOCATION_TIME.TIME_TYPE.DESCRIPTION' | translate }}
                        </p>
                        <div class="tipo-horario-selector" 
                             role="radiogroup" 
                             [attr.aria-labelledby]="'tipo-horario-' + i + '-label'"
                             [attr.aria-describedby]="'tipo-horario-' + i + '-desc tipo-horario-' + i + '-hint'">
                            <div class="radio-option">
                                <input type="radio" 
                                       [id]="'horaUnica-' + i" 
                                       formControlName="tipoHorario" 
                                       value="hora" 
                                       (change)="toggleTipoHorario(false, ubicacion)"
                                       [attr.aria-describedby]="'tipo-horario-' + i + '-desc hora-unica-' + i + '-desc'"
                                       [required]="true">
                                <span [id]="'hora-unica-' + i + '-desc'" class="visually-hidden"></span>
                                <label [for]="'horaUnica-' + i" >{{ 'FORM.LOCATION_TIME.TIME_TYPE.UNIQUE_TIME' | translate }}</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" 
                                       [id]="'horarioCompleto-' + i" 
                                       formControlName="tipoHorario" 
                                       value="horario" 
                                       (change)="toggleTipoHorario(true, ubicacion)"
                                       [attr.aria-describedby]="'tipo-horario-' + i + '-desc horario-completo-' + i + '-desc'"
                                       [required]="true">
                                <span [id]="'horario-completo-' + i + '-desc'" class="visually-hidden"></span>
                                <label [for]="'horarioCompleto-' + i" >{{ 'FORM.LOCATION_TIME.TIME_TYPE.FULL_SCHEDULE' | translate }}</label>
                            </div>
                        </div>
                       
                        @if (ubicacion.get('tipoHorario')?.invalid && ubicacion.get('tipoHorario')?.touched) {
                            <p class="mensaje_error" 
                               [id]="'tipo-horario-' + i + '-error'" 
                               role="alert"
                               aria-live="assertive">
                                {{ 'FORM.LOCATION_TIME.TIME_TYPE.ERROR' | translate }}
                            </p>
                        }

                        @if (ubicacion.get('tipoHorario')?.value === 'hora') {
                            <div class="campo-hora">
                                <label [for]="'horaInicio-' + i" [id]="'hora-inicio-' + i + '-label'">{{ 'FORM.LOCATION_TIME.TIME.LABEL' | translate }} <span class="campo-requerido">*</span></label>
                                <p [id]="'hora-inicio-' + i + '-desc'" class="campo-descripcion">
                                    {{ 'FORM.LOCATION_TIME.TIME.DESCRIPTION' | translate }}
                                </p>
                                <input type="time" 
                                       [id]="'horaInicio-' + i" 
                                       formControlName="horaInicio"
                                       [attr.aria-describedby]="'hora-inicio-' + i + '-desc hora-inicio-' + i + '-error'"
                                       aria-required="true">
                            </div>
                        }

                        @if (ubicacion.get('tipoHorario')?.value === 'horario') {
                            <div class="horario-container">
                                <div class="campo-hora">
                                    <label [for]="'horaInicio-' + i" [id]="'hora-inicio-' + i + '-label'">{{ 'FORM.LOCATION_TIME.START.LABEL' | translate }} <span class="campo-requerido">*</span></label>
                                    <p [id]="'hora-inicio-' + i + '-desc'" class="campo-descripcion">
                                        {{ 'FORM.LOCATION_TIME.START.DESCRIPTION' | translate }}
                                    </p>
                                    <input type="time" 
                                           [id]="'horaInicio-' + i" 
                                           formControlName="horaInicio">
                                </div>

                                <div class="campo-hora">
                                    <label [for]="'horaFin-' + i" [id]="'hora-fin-' + i + '-label'">{{ 'FORM.LOCATION_TIME.END.LABEL' | translate }} <span class="campo-requerido">*</span></label>
                                    <p [id]="'hora-fin-' + i + '-desc'" class="campo-descripcion">
                                        {{ 'FORM.LOCATION_TIME.END.DESCRIPTION' | translate }}
                                    </p>
                                    <input type="time" 
                                           [id]="'horaFin-' + i" 
                                           formControlName="horaFin"
                                           [attr.aria-describedby]="'hora-fin-' + i + '-desc hora-fin-' + i + '-error'">
                                </div>
                            </div>
                        }
                    </div>

                    <div class="campo-form lugar-section" role="group" [attr.aria-labelledby]="'lugar-' + i + '-label'">
                        <label [for]="'lugar-' + i" [id]="'lugar-' + i + '-label'">{{ 'FORM.LOCATION_TIME.EVENT_PLACE.LABEL' | translate }} <span class="campo-requerido">*</span></label>
                        <p [id]="'lugar-' + i + '-desc'" class="campo-descripcion visually-hidden">
                            {{ 'FORM.LOCATION_TIME.EVENT_PLACE.DESCRIPTION' | translate }}
                            <span class="campo-requerido">Campo obligatorio</span>
                        </p>
                        <div class="select-container">
                            <select [id]="'lugar-' + i" 
                                    formControlName="lugar"
                                    [attr.aria-describedby]="'lugar-' + i + '-desc lugar-' + i + '-hint lugar-' + i + '-error'"
                                    aria-required="true"
                                    [attr.aria-invalid]="ubicacion.get('lugar')?.invalid && ubicacion.get('lugar')?.touched">
                                <option value="">{{ 'LOCATIONS.SELECT_OPTION' | translate }}</option>
                                <optgroup [label]="'LOCATIONS.PRESENTIAL_SPACES' | translate">
                                    @for (lugarPresencial of lugaresPresenciales; track lugarPresencial) {
                                        <option [value]="lugarPresencial">{{ 'LOCATIONS.' + lugarPresencial | translate }}</option>
                                    }
                                </optgroup>
                                <optgroup [label]="'LOCATIONS.VIRTUAL_SPACES' | translate">
                                    @for (lugarVirtual of lugaresVirtuales; track lugarVirtual) {
                                        <option [value]="lugarVirtual">{{ 'LOCATIONS.' + lugarVirtual | translate }}</option>
                                    }
                                </optgroup>
                            </select>
                        </div>
                       
                        @if (ubicacion.get('lugar')?.invalid && ubicacion.get('lugar')?.touched) {
                            <p class="mensaje_error" 
                               [id]="'lugar-' + i + '-error'" 
                               role="alert"
                               aria-live="assertive">
                                {{ 'FORM.LOCATION_TIME.EVENT_PLACE.ERROR' | translate }}
                            </p>
                        }
                        @if (!(ubicacion.get('lugar')?.invalid && ubicacion.get('lugar')?.touched)) {
                            <span [id]="'lugar-' + i + '-error'" class="visually-hidden"></span>
                        }

                        @if (ubicacion.get('lugar')?.value === 'FACULTY') {
                            <div class="campo-aula">
                                <label [for]="'aula-' + i" [id]="'aula-' + i + '-label'">{{ 'FORM.LOCATION_TIME.CLASSROOM.LABEL' | translate }} <span class="campo-requerido">*</span></label>
                                <p [id]="'aula-' + i + '-desc'" class="campo-descripcion">
                                    {{ 'FORM.LOCATION_TIME.CLASSROOM.DESCRIPTION' | translate }}
                                    <span class="campo-requerido">Campo obligatorio</span>
                                </p>
                                <input type="text" 
                                       [id]="'aula-' + i" 
                                       formControlName="aula"
                                       [attr.aria-describedby]="'aula-' + i + '-desc aula-' + i + '-error'"
                                       aria-required="true"
                                       [attr.aria-invalid]="ubicacion.get('aula')?.invalid && ubicacion.get('aula')?.touched">
                                @if (ubicacion.get('aula')?.hasError('required') && ubicacion.get('aula')?.touched) {
                                    <p class="mensaje_error" 
                                       [id]="'aula-' + i + '-error'" 
                                       role="alert"
                                       aria-live="assertive">
                                        {{ 'FORM.LOCATION_TIME.CLASSROOM.ERROR' | translate }}
                                    </p>
                                }
                                @if (!(ubicacion.get('aula')?.hasError('required') && ubicacion.get('aula')?.touched)) {
                                    <span [id]="'aula-' + i + '-error'" class="visually-hidden"></span>
                                }
                            </div>
                        }
                    </div>
                </div>
                @if (i < listadoUbicaciones.length - 1) {
                    <hr>
                }
            }

            <div class="boton-agregar-container">
                <button type="button" 
                        (click)="agregarUbicacion()"
                        class="btn-agregar-inline"
                        aria-label="AÃ±adir nueva fecha y lugar">
                    <span class="icono-agregar" aria-hidden="true">+</span>
                    {{ 'FORM.LOCATION_TIME.ADD_DATE_PLACE' | translate }}
                </button>
            </div>
        </div>
    </div>

    <button type="submit"  class="btn-finalizar">{{ 'FORM.SUBMIT_BUTTON' | translate }}</button>
</form>

<!-- DiÃ¡logo de confirmaciÃ³n -->
@if (mostrarDialog) {
    <div  class="dialog-backdrop">
        <dialog 
            open 
            id="myDialog"
            role="dialog"
            aria-modal="true"
            aria-labelledby="dialog-title"
            aria-describedby="dialog-content"
            (keydown.escape)="closeDialog()">
            <h2 id="dialog-title" tabindex="-1">{{ 'FORM.DIALOG.EVENT_CREATED.TITLE' | translate }}</h2>
            <p id="dialog-content">{{ 'FORM.DIALOG.EVENT_CREATED.MESSAGE' | translate }}</p>
            <form method="dialog">
                <button 
                    (click)="closeDialog()"
                    aria-label="Aceptar">
                    {{ 'FORM.DIALOG.ACCEPT' | translate }}
                </button>
            </form>
        </dialog>
    </div>
}