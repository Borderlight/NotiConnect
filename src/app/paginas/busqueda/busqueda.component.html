<div class="busqueda-container">
  <section class="filtros-section" aria-labelledby="filtros-titulo">
    <h2 id="filtros-titulo">{{ 'SEARCH.FILTERS_TITLE' | translate }}</h2>
    
    <form [formGroup]="formularioBusqueda" (ngSubmit)="buscarEventos()" class="filtros-form">
      <!-- Primera fila de filtros -->
      <div class="fila-filtros">
        <!-- Tipo de Evento -->
        <div class="campo-filtro">
          <label for="tipoEvento" id="tipo-label">{{ 'SEARCH.EVENT_TYPE' | translate }}</label>
          <select id="tipoEvento" 
                  formControlName="tipoEvento"
                  aria-labelledby="tipo-label"
                  class="filtro-select">
            <option value="">{{ 'SEARCH.ALL_TYPES' | translate }}</option>
            @for (tipo of tiposEvento; track tipo) {
              <option [value]="tipo">{{ 'EVENT_TYPES.' + tipo | translate }}</option>
            }
          </select>
        </div>

        <!-- Ponente -->
        <div class="campo-filtro" style="margin-right: 20px;">
          <label for="ponente" id="ponente-label">{{ 'SEARCH.SPEAKER' | translate }}</label>
          <input type="text" 
                 id="ponente" 
                 formControlName="ponente"
                 aria-labelledby="ponente-label"
                 [placeholder]="'SEARCH.SPEAKER_PLACEHOLDER' | translate"
                 class="filtro-input">
        </div>

        <!-- Actividad -->
        <div class="campo-filtro" style="margin-right: 20px;">
          <label for="actividad" id="actividad-label">{{ 'SEARCH.ACTIVITY' | translate }}</label>
          <select id="actividad" 
                  formControlName="actividad"
                  aria-labelledby="actividad-label"
                  class="filtro-select">
            <option value="">{{ 'SEARCH.ALL_ACTIVITIES' | translate }}</option>
            @for (actividad of actividadesRelacionadas; track actividad) {
              <option [value]="actividad">{{ actividad }}</option>
            }
          </select>
        </div>

        <!-- Servicios -->
        <div class="campo-filtro">
          <label for="servicio" id="servicio-label">{{ 'SEARCH.SERVICE' | translate }}</label>
          <select id="servicio" 
                  formControlName="servicio"
                  aria-labelledby="servicio-label"
                  class="filtro-select">
            <option value="">{{ 'SEARCH.ALL_SERVICES' | translate }}</option>
            @for (servicio of serviciosDisponibles; track servicio) {
              <option [value]="servicio">{{ 'SERVICES.' + servicio | translate }}</option>
            }
          </select>
        </div>
      </div>

      <!-- Segunda fila de filtros -->
      <div class="fila-filtros" style="margin-bottom: 20px;">
        <!-- Fecha -->
        <div class="campo-filtro" style="margin-right: 15px;">
          <label for="fecha" id="fecha-label">Fecha</label>
          <input type="date" 
                 id="fecha" 
                 formControlName="fecha"
                 aria-labelledby="fecha-label"
                 class="filtro-input">
        </div>

        <!-- Hora de Inicio -->
        <div class="campo-filtro" style="margin-right: 15px;">
          <label for="horaInicio" id="hora-inicio-label">Hora de Inicio</label>
          <input type="time" 
                 id="horaInicio" 
                 formControlName="horaInicio"
                 aria-labelledby="hora-inicio-label"
                 class="filtro-input">
        </div>

        <!-- Hora de Fin -->
        <div class="campo-filtro" style="margin-right: 15px;">
          <label for="horaFin" id="hora-fin-label">Hora de Fin</label>
          <input type="time" 
                 id="horaFin" 
                 formControlName="horaFin"
                 aria-labelledby="hora-fin-label"
                 class="filtro-input">
        </div>

        <!-- Lugar -->
        <div class="campo-filtro">
          <label for="lugar" id="lugar-label">Lugar</label>
          <select id="lugar" 
                  formControlName="lugar"
                  aria-labelledby="lugar-label"
                  class="filtro-select">
            <option value="">Todos los lugares</option>
            @for (lugar of lugares; track lugar) {
              <option [value]="lugar">{{ lugar }}</option>
            }
          </select>
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="botones-container">
        <button type="submit" class="btn-buscar">
          <i class="fas fa-search"></i>
          {{ 'SEARCH.SEARCH_BUTTON' | translate }}
        </button>
        <button type="button" class="btn-limpiar" (click)="limpiarFiltros()">
          <i class="fas fa-eraser"></i>
          {{ 'SEARCH.CLEAR_BUTTON' | translate }}
        </button>
      </div>
    </form>

    @if (mostrarResultados) {
      <div class="opciones-resultados">
        <div class="botones-resultados" style="display: flex; justify-content: flex-start; gap: 15px;">
          <button class="btn-opcion btn-descargar" (click)="abrirModalDescarga()">
            <i class="fas fa-download"></i>
            {{ 'SEARCH.DOWNLOAD' | translate }}
          </button>
          <button class="btn-opcion btn-eliminar" (click)="eliminarEventosFiltrados()">
            <i class="fas fa-trash"></i>
            {{ 'SEARCH.DELETE' | translate }}
          </button>
        </div>
      </div>
    }
  </section>

  <!-- Modal de descarga -->
  @if (mostrarModalDescarga) {
    <app-descargar-modal
      [eventos]="eventosFiltrados"
      (cerrar)="cerrarModalDescarga()"
      (descargar)="manejarDescarga($event)">
    </app-descargar-modal>
  }

  <!-- Resultados de la búsqueda -->
  @if (mostrarResultados) {
    <section class="resultados-section">
      <div class="resultados-header">
        <h2>{{ 'SEARCH.RESULTS_TITLE' | translate }}</h2>
        <span class="contador-resultados">{{eventosFiltrados.length}} {{ 'SEARCH.EVENTS_FOUND' | translate }}</span>
      </div>

      @if (eventosFiltrados.length > 0) {
        <div class="grid-eventos">
          @for (evento of eventosFiltrados; track evento._id) {
            <app-evento 
              [evento]="evento"
              (eliminar)="eliminarEvento($event)">
            </app-evento>
          }
        </div>
      } @else {
        <div class="no-resultados">
          <p>{{ 'SEARCH.NO_RESULTS' | translate }}</p>
        </div>
      }
    </section>
  }
</div>
